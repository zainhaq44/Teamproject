                           AI Construction Safety Inspector Project Documentation

1. Executive Summary

The AI Construction Safety Inspector is a streamlined, end-to-end automation system designed to provide real-time safety compliance analysis for construction site images. 
The system, orchestrated by n8n and utilizing the Gemini Vision API, instantly processes images uploaded via the Lovable platform. It detects critical safety violations, including missing helmets, vests, and harness issues.
The system generates a safety score, instantly notifies relevant personnel via email if the score is below a critical threshold (80), and stores all results in Supabase for auditing. 
This project delivers a highly efficient, scalable solution that minimizes manual inspection time and provides immediate, data-driven safety oversight.

2. Project Objectives & Scope

Objectives:

Automate safety inspection upon image upload from the Lovable frontend.
Utilize Gemini to accurately detect missing helmets, vests, unsafe ladders, and harness issues.
Generate a structured JSON output with a definitive Safety Score (0-100).
Trigger an email alert if the Safety Score drops below 80.
Store all analysis results in a Supabase database for historical tracking.
Lay the foundation for a highly scalable solution.
Scope (Inclusions)
Frontend image upload via Lovable platform.
Full automation pipeline in n8n (10 nodes).
Storage and retrieval using Supabase (bucket and tables).
AI model inference using Gemini.
Notification delivery via SMTP Email.
PDF report generation handled externally by the Lovable platform.

Out of Scope (Exclusions):

Real-time video detection.
On-device offline detection.
Integration with WhatsApp or other messaging services.
Worker identity verification.
Detection of debris or blocked paths (based on current model prompt).

3. System Architecture & Workflow: 
The system operates using a 10-step sequential workflow that begins with an external image upload from the Lovable frontend.

The architecture is composed of several key components:
- Frontend Input: The initial image capture and upload point is handled by Lovable.
- Backend Orchestrator: The execution of the entire 10-step automation pipeline is managed by n8n.
- Vision AI Model: Image analysis is performed by Gemini (Vision API), which returns a structured JSON object containing all detection details and the safety score.
- Storage and Database: Supabase handles both data persistence needs. Supabase Storage Buckets are used to securely hold the raw uploaded images, while Supabase Postgres Tables store all the resulting analysis logs and scores.
- Reporting: The system sends immediate critical alerts via SMTP Email, specifically utilizing the Send Gmail Node for notification delivery.

Detailed 10-Node Workflow

1) Webhook Node (n8n): Receives the image data from the Lovable frontend.
2) Edit Field Node: Prepares the image data by adding a binary filename.
3) HTTP Node: Uploads the binary image data to the designated Supabase Bucket.
4) Edit Field Node: Extracts and formats the public URL of the newly uploaded image.
5) Analyze Image Node (Gemini): Sends the image URL and the specialized prompt to the Gemini Vision API for safety analysis.
6) Respond to Webhook Node: Sends an immediate confirmation/initial result back to the Lovable platform, ensuring the connection is quickly closed.
7) Code Node (Java): Cleans and validates the JSON output received from Gemini, ensuring field consistency before storage.
8) Supabase Node: Creates a new row in the database with the cleaned detection results, score, and timestamp.
9) IF Node: Checks a critical condition: Safety Score < 80.
10) Email Node (SMTP): If the condition in the IF Node is True, an alert email is sent to the safety officer/supervisor.

4. Technical Stack & Logic

AI Prompting & Output Structure
The system relies on a strictly controlled prompt to ensure reliable, predictable output from the Gemini API.

System Prompt (Summary): You are a construction safety inspector. Analyze the image and return ONLY a single JSON object in the exact specified structure. If the image is not construction-related, set all counts to 0 and the summary to: "This image is not related to construction."

Required JSON Output Structure:
JSON
{
  "total_workers": 0,
  "without_helmet": 0,
  "without_vest": 0,
  "unsafe_ladders": 0,
  "harness_issues": 0,
  "safety_score": 0,
  "analysis_summary": "your summary here",
  "image_url": "..."
}


Code Node (Java)
The Code Node executes a cleaning function to ensure data integrity before it hits the database.

Logic: The node is responsible for handling null or unexpected values from the Gemini response, standardizing field names, and confirming data types (e.g., ensuring all count fields are correctly formatted integers).

Alert Logic
The system enforces a safety threshold:
$$\text{Alert Triggered} \iff \text{Safety Score} < 80$$

5. Scalability and Future Impact
This architecture is built for rapid deployment and future expansion:
- Scalability: By leveraging the cloud-based Gemini API and Supabase, the system can handle a significant increase in image volume without major infrastructure changes. The API-driven nature removes manual upload dependencies.
- Future Enhancement: The current manual picture upload can be replaced by a simple integration that captures a live camera feed, automatically triggering the existing n8n workflow for continuous, real-time safety monitoring.
- Analytics: The structured data stored in Supabase is immediately ready for advanced analytics, allowing the creation of historical dashboards for trend identification and predictive safety management.

                                              Deployment Instructions

The project requires sequential setup across three major platforms before the full 10-node workflow can be activated.

Phase 1: Supabase Setup (Storage and Database)

- Project Creation: Create a new project in your Supabase dashboard.
- Database Schema: Navigate to the Table Editor and create the primary table for safety logs (e.g., safety_logs). The schema must match the Gemini JSON output (e.g., safety_score as an integer, analysis_summary as text, image_url as text).
- Storage Bucket: Navigate to the Storage section and create a new Bucket (e.g., safety-images). Set the Bucket Policy to allow file uploads via the n8n HTTP node (Step 3 in the workflow).
- API Keys: Obtain the Project URL and the Service Role Key/Anon Key from Project Settings > API. These are required for n8n to connect to the database and storage.

Phase 2: n8n Cloud Setup (Backend Workflow)

- Subscription: Ensure you have an active n8n Cloud subscription (Starter or Pro plan).
- Access Instance: Log into your managed n8n Cloud instance.
- Credentials Setup: Navigate to Credentials and create the following entries:
- Gmail/SMTP: Set up OAuth credentials for the email node (this requires configuration in the Google Cloud Console to get the necessary Client ID and Client Secret).
- Supabase: Input the Project URL and Service Role Key obtained from Phase 1.
- Gemini: Input your Gemini API Key.
- Workflow Import: Import the 10-node JSON workflow file into your n8n workspace.

Phase 3: Workflow Configuration and Frontend Integration

- Configure Supabase Nodes: In the n8n workflow, configure the following nodes:
- HTTP Node (Upload): Set the URL and authentication to upload the binary file to the Supabase Storage Bucket created in Phase 1.
- Supabase Node (Create Row): Connect this node using the Supabase credential and ensure it targets the correct safety_logs table.
- Activate Webhook: Activate the Webhook node (Node 1) in n8n. Copy the publicly exposed Test/Production Webhook URL.
- Lovable Frontend: In the Lovable platform:
- Set up your image upload interface.
- Configure the upload button or submission logic to make a POST request to the n8n Webhook URL copied in the previous step.

Final Test: Upload a test image through the Lovable frontend. Verify the following:

- The image appears in the Supabase Storage Bucket.
- A new row appears in the Supabase safety_logs table.
- If the score is below 80, the email alert is successfully sent.

                                                 Cost Estimation

This project is engineered for maximum cost-efficiency, prioritizing free services and minimal operational spending.

1. Service Cost Breakdown (Infrastructure)

- Lovable (Frontend):
The Pro Plan is the required especially in case of short deadlines, minimum cost is $25 / month. This tier is essential for commercial viability, supporting Private Projects and Custom Domains.
- Supabase (Storage + Database):
The Free Tier costs $0 and is sufficient for early stages (Postgres tables and Storage Buckets).
The Pro Tier at $25 / month is only necessary for high-volume enterprise usage.
- n8n Hosting (Backend Workflow):
Utilizes the OCI Free Tier (AMD VM), resulting in a $0 cost for the self-hosted backend automation.
- Email Service (Send Gmail Node):
This service costs $0, relying on existing Google/Gmail infrastructure for alerts.

2. Google Gemini 2.0 Flash Light (Variable Operational Cost)

Given the use of the highly optimized "Flash Light" version, the cost is extremely low, aligning with the project's minimal operational expense goal. We use an estimated rate of ≈$0.004 per image to reflect its specialized, low-cost nature.

- Cost per 1,000 Images: ≈$4.00
- Cost per 10,000 Images: ≈$40.00

3. Monthly Cost Summary (Production Reality)

- Minimum Production App (1,000 Images): Total cost is ≈$29 per month ($25 for Lovable Pro + $4.00 for Gemini).
- Medium Scale App (10,000 Images): Total cost is ≈$65 per month ($25 for Lovable Pro + $40.00 for Gemini).
- Enterprise Scale (50,000 Images): Total cost is ≈$250 per month ($25 for Lovable Pro + $200.00 for Gemini + $25 for Supabase Pro).

4. One-Time Development Cost:

n8n workflow (10 nodes): $400 – $600
Supabase schema + storage config: $150 – $250
Gemini 2.0 Flash Light prompt engineering: $80 – $150
Lovable UI (upload, results visualization): $400 – $600
QA / testing / integration: $150 – $200
Total (One-Time): $1,200 – $1,800

                                               Overall Conclusion
The AI Construction Safety Inspector achieves a near-zero infrastructure cost model. The primary operational expense is the extremely efficient Gemini Vision AI.
Even at high Enterprise scale (50,000 images), the total monthly operational cost remains highly competitive at ≈$250.
